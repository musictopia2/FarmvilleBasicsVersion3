@inherits FarmComponentBase
@if (ProgressionManager.CompletedGame)
{
    <div>
        You completed the game.  Therefore, no need to see the shop.
    </div>
    return;
}

<PopupViewport
    TapToClose=true
    @bind-Visible="_showConfirmation"
    ShowHeaders="false"
>
    <AcquireConfirmation StoreItem="_currentItem"
                         OnAcquire="ConfirmedAsync"   />
</PopupViewport>

<TabButtonContainer ActiveKey="@StoreManager.CurrentCategory.ToString()"
                    ActiveKeyChanged="OnActiveKeyChanged">

    @foreach (var tab in Tabs)
    {
        <div class="shop-shell">
            <TabPage Text="@tab.Text" Key="@tab.Category.ToString()">
                <StopClickPropagation Class="shop-scroll">
                    <WrapLayout RenderList="_list"
                                Context="row"
                                ColumnWidth="320px">
                        <div class="shop-card @CardStateClass(row)"
                             role="button"
                             tabindex="0"
                             @onclick="() => OnRowClicked(row)">

                            <!-- Top row: status icon + name -->
                            <div class="shop-card-top">
                                <div class="shop-status">
                                    @if (row.IsLocked)
                                    {
                                        <img class="shop-status-img" src="/padlock.png" alt="Locked" />
                                    }
                                    else if (row.IsMaxedOut)
                                    {
                                        <span class="shop-status-svg" aria-label="Maxed">
                                            @* inline svg so you can color it green *@
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M20 6L9 17l-5-5" />
                                            </svg>
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="shop-status-placeholder"></span>
                                    }
                                </div>

                                <div class="shop-title" title="@row.TargetName.GetWords">
                                    @row.TargetName.GetWords
                                </div>
                            </div>

                            <!-- Bottom row: costs (left), owned/max (middle), item image (right) -->
                            <div class="shop-card-bottom">
                                <div class="shop-costs">
                                    @if (row.IsMaxedOut)
                                    {
                                        <span class="shop-muted">Maxed</span>
                                    }
                                    else if (row.IsLocked)
                                    {
                                        <span class="shop-muted">Level @row.LevelRequired</span>
                                    }
                                    else if (row.IsFree)
                                    {
                                        <span class="shop-muted">Free</span>
                                    }
                                    else
                                    {
                                        @foreach (var cost in row.Costs)
                                        {
                                            <div class="shop-cost-pill">
                                                <img class="shop-cost-img" src="@CostImageUrl(cost.Key)" alt="" />
                                                <span class="shop-cost-amt">@cost.Value.ToString("N0")</span>
                                            </div>
                                        }
                                    }
                                </div>

                                <div class="shop-owned">
                                    @row.OwnedCount/@row.TotalPossible
                                </div>

                                <div class="shop-item">
                                    <img class="shop-item-img" src="@ImageUrl(row)" alt="" />
                                </div>
                            </div>
                        </div>

                    </WrapLayout>
                </StopClickPropagation>
               


            </TabPage>
        </div>

    }

</TabButtonContainer>
@inherits FarmComponentBase
<CascadingValue IsFixed=true Value="_overlays">

    
    <IntegerInputModal Visible="quantityPickerService.Visible"
        MaxValue="quantityPickerService.MaxValue"
        StartBlank="true"
        ValueChanged="OnValueChanged"
                       VisibleChanged="VisibleChanged">
        @quantityPickerService.MaxValue
    </IntegerInputModal>


    <PopupViewport GapLeftPx="10"
                   GapRightPx="10"
                   GapTopPx="10"
                   GapBottomPx="10"
                   ShowHeaders="true"
                   HeaderTitle="Barn"
                   CloseButtonClick="CloseBarn"
                   @bind-Visible="_showBarn">
        <InventoryDisplayComponent InventoryStorageCategory="EnumInventoryStorageCategory.Barn" />
    </PopupViewport>

    <PopupViewport GapLeftPx="10"
                   GapRightPx="10"
                   GapTopPx="10"
                   GapBottomPx="10"
                   ShowHeaders="true"
                   HeaderTitle="Silo"
                   @bind-Visible="_showSilo">
        <InventoryDisplayComponent InventoryStorageCategory="EnumInventoryStorageCategory.Silo" />
    </PopupViewport>

    <PopupViewport
        ShowHeaders="true"
        HeaderTitle="Shop"
        TapToClose="true"
        @bind-Visible="_showShop"
    >
        <ShopComponent />
    </PopupViewport>
    

    <NavigationBarContainer @ref="_nav"
                            AlwaysShowBar=true
                            ShowBack="false"
                            Title="@Title">
        <IndicatorContent>

            <div class="indicator-row">
                <div class="indicator-left">
                    <CoinIndicator />
                </div>
                <div>
                    <LevelIndicator />
                </div>
                <div class="indicator-right">
                    <CompletionBell />
                </div>
            </div>

        </IndicatorContent>
        <BarContent>
            
            <button class="icon-btn"
                    title="Close all popups"
                    aria-label="Close all popups"
                    @onclick="CloseAllPopupsAsync">
                <svg viewBox="0 0 24 24" width="40" height="40"
                     fill="none" stroke="white" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="9" />
                    <line x1="9" y1="9" x2="15" y2="15" />
                    <line x1="15" y1="9" x2="9" y2="15" />
                </svg>
            </button>

            <button class="icon-btn"
                    title="Home"
                    aria-label="Go to home"
                    @onclick="ChooseAnotherTheme">
                <svg viewBox="0 0 24 24" width="40" height="40"
                     fill="none" stroke="white" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 10.5L12 3l9 7.5" />
                    <path d="M5 10v9h14v-9" />
                </svg>
            </button>
        </BarContent>
        <HeaderContent>
            <QuestTrackerComponent />
        </HeaderContent>
        <MainContent>
            @if (ProgressionManager.CompletedGame)
            {
                <div>
                    You completed the game
                </div>
                return;
            }
            <OverlayHost />
            <ImageButtonComponent OnClick="ShowShop" Name="CashRegister" Height="100" />
            <MainSectionLauncher ReadyCategory="EnumMainSection.Crops" />
            <MainSectionLauncher ReadyCategory="EnumMainSection.Trees" />
            <MainSectionLauncher ReadyCategory="EnumMainSection.Animals" />
            <MainSectionLauncher ReadyCategory="EnumMainSection.Workshops" />
            <div>
                <WorksitesComponent />
            </div>
            
            
            <ImageButtonComponent Name="Barn" Width="100" OnClick="ShowBarn" />
            <ImageButtonComponent Name="Silo" Width="100" OnClick="ShowSilo" />



        </MainContent>
    </NavigationBarContainer>
</CascadingValue>